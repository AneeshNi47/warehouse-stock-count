<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Counter Dashboard - DSV Stock Count</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    
    <!-- Header -->
    <div class="text-center mb-6">
      <h1 class="text-2xl md:text-3xl font-bold text-blue-900 mb-2">DSV STOCK COUNT</h1>
      <p class="text-gray-600">Counter Dashboard</p>

      <div class="mt-3 p-3 bg-blue-50 rounded-lg inline-block">
        <span class="text-blue-800 font-medium">Logged in as: {{ current_user.username }}</span>
        <a href="{{ url_for('auth.logout') }}" 
           class="ml-3 text-blue-600 hover:text-blue-800 text-sm underline">
          Sign Out
        </a>
      </div>
    </div>

    <!-- Tabs -->
    <div class="flex justify-center mb-6">
      <button id="tabActiveJobs"
              class="tab-btn bg-blue-600 text-white px-6 py-2 rounded-l-lg font-medium">
        Active Jobs
      </button>
      <button id="tabOtherJobs"
              class="tab-btn bg-gray-200 text-gray-700 px-6 py-2 rounded-r-lg font-medium">
        Other Jobs
      </button>
    </div>

    <!-- Active Jobs -->
    <div id="activeJobsTable" class="tab-content">
      <h2 class="text-lg font-semibold mb-3">Active Jobs</h2>
      <div class="overflow-x-auto bg-white shadow-md rounded-lg">
        <table class="w-full border border-gray-200 text-sm">
          <thead class="bg-gray-100 text-gray-700">
            <tr>
              <th class="p-2 text-left">Line Code</th>
              <th class="p-2 text-left">Location</th>
              <th class="p-2 text-left">Warehouse</th>
              <th class="p-2 text-left">Target Count</th>
              <th class="p-2 text-left">Status</th>
              <th class="p-2 text-left">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for line in active_jobs %}
            <tr class="hover:bg-gray-50">
              <td class="p-2 font-medium">{{ line.line_code }}</td>
              <td class="p-2">{{ line.location.name }}</td>
              <td class="p-2">{{ line.warehouse.warehouse_name }}</td>
              <td class="p-2">{{ line.target_count }}</td>
              <td class="p-2 text-blue-700 font-semibold">{{ line.status }}</td>
              <td class="p-2">
                <a href="{{ url_for('counter.view_scan_line', id=line.id) }}" 
                   class="text-blue-600 hover:underline">View</a>
              </td>
            </tr>
            {% else %}
            <tr><td colspan="6" class="p-4 text-center text-gray-500">No active jobs assigned</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Other Jobs -->
    <div id="otherJobsTable" class="tab-content hidden">
      <h2 class="text-lg font-semibold mb-3">Other Jobs</h2>
      <div class="overflow-x-auto bg-white shadow-md rounded-lg">
        <table class="w-full border border-gray-200 text-sm">
          <thead class="bg-gray-100 text-gray-700">
            <tr>
              <th class="p-2 text-left">Line Code</th>
              <th class="p-2 text-left">Location</th>
              <th class="p-2 text-left">Warehouse</th>
              <th class="p-2 text-left">Target Count</th>
              <th class="p-2 text-left">Status</th>
              <th class="p-2 text-left">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for line in other_jobs %}
            <tr class="hover:bg-gray-50">
              <td class="p-2 font-medium">{{ line.line_code }}</td>
              <td class="p-2">{{ line.location.name }}</td>
              <td class="p-2">{{ line.warehouse.warehouse_name }}</td>
              <td class="p-2">{{ line.target_count }}</td>
              <td class="p-2 font-semibold
                  {% if line.status == 'Completed' %}text-green-600
                  {% elif line.status == 'Variance Submitted' %}text-yellow-600
                  {% elif line.status == 'Discarded' %}text-red-600{% endif %}">
                {{ line.status }}
              </td>
              <td class="p-2">
                {% if line.status != 'Discarded' %}
                  <a href="{{ url_for('counter.view_scan_line', id=line.id) }}" 
                     class="text-blue-600 hover:underline">View</a>
                {% else %}
                  <span class="text-gray-400 italic">No action</span>
                {% endif %}
              </td>
            </tr>
            {% else %}
            <tr><td colspan="6" class="p-4 text-center text-gray-500">No completed or discarded jobs</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // === Tab switching ===
    const tabActive = document.getElementById('tabActiveJobs');
    const tabOther = document.getElementById('tabOtherJobs');
    const tableActive = document.getElementById('activeJobsTable');
    const tableOther = document.getElementById('otherJobsTable');

    function switchTab(tab) {
      if (tab === 'active') {
        tabActive.classList.add('bg-blue-600', 'text-white');
        tabActive.classList.remove('bg-gray-200', 'text-gray-700');
        tabOther.classList.add('bg-gray-200', 'text-gray-700');
        tabOther.classList.remove('bg-blue-600', 'text-white');
        tableActive.classList.remove('hidden');
        tableOther.classList.add('hidden');
      } else {
        tabOther.classList.add('bg-blue-600', 'text-white');
        tabOther.classList.remove('bg-gray-200', 'text-gray-700');
        tabActive.classList.add('bg-gray-200', 'text-gray-700');
        tabActive.classList.remove('bg-blue-600', 'text-white');
        tableOther.classList.remove('hidden');
        tableActive.classList.add('hidden');
      }
    }

    tabActive.addEventListener('click', () => switchTab('active'));
    tabOther.addEventListener('click', () => switchTab('other'));
  </script>
</body>
</html>